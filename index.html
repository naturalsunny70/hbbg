<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>생일 축하 풍선터뜨리기 게임 (PC/모바일)</title>

  <!-- 모바일환경에서 pinch zoom, 더블탭 확대 방지 -->
  <meta name="viewport" content="width=device-width, maximum-scale=1.0, user-scalable=no" />

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      text-align: center;
      background: #fff;
    }
    h1 {
      margin: 20px;
    }
    /* 모바일 확대 방지 */
    html, body {
      touch-action: none; 
      -webkit-user-select: none;
      -webkit-touch-callout: none;
      -webkit-text-size-adjust: none;
      overscroll-behavior: none;
    }

    /* 게임 영역 */
    #gameContainer {
      position: relative;
      width: 100vw;
      height: 70vh;
      overflow: hidden;
      background: #fce4ec;
    }

    /* 풍선 스타일 */
    .balloon {
      position: absolute;
      width: 60px;
      height: 80px;
      border-radius: 50% 50% 40% 40%;
      cursor: pointer;
      transition: transform 0.1s;
    }
    .balloon:hover {
      transform: scale(1.1);
    }

    /* 점수판, 버튼 */
    #scoreBoard {
      font-size: 1.2rem;
      margin: 20px;
    }
    #startButton, #restartButton {
      padding: 10px 20px;
      margin: 5px;
      font-size: 1rem;
      cursor: pointer;
      border: none;
      border-radius: 5px;
      color: #fff;
    }
    #startButton {
      background: #ff4081;
    }
    #restartButton {
      background: #03a9f4;
      display: none;
    }
    #gameOverMessage {
      font-size: 1.5rem;
      margin: 10px;
      display: none;
      color: #e91e63;
    }

    /* 폭죽(분수형) 효과 컨테이너 */
    #fireworksContainer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      overflow: hidden;
      z-index: 9999;
    }
    .spark {
      position: absolute;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: red;
      opacity: 0;
      animation: fountainAnim 2s ease-out forwards;
    }
    @keyframes fountainAnim {
      0% {
        transform: translate(0, 0) scale(0.3);
        opacity: 1;
      }
      25% {
        opacity: 1;
      }
      100% {
        transform: translate(var(--spark-tx, 0), var(--spark-ty, 0)) scale(1.8);
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <h1 id="title">생일 축하 풍선터뜨리기 게임</h1>

  <!-- (옵션) 생일 축하 노래 파일이 존재해야 함. -->
  <audio id="happySong" src="happy_birthday_song.mp3" preload="auto"></audio>
  
  <div id="gameContainer"></div>
  
  <div id="scoreBoard">점수: <span id="score">0</span></div>
  <button id="startButton">게임 시작</button>
  <button id="restartButton">다시 시작</button>
  
  <div id="gameOverMessage">축하합니다! 풍선을 모두 터뜨렸어요!</div>
  
  <script>
    // PC/모바일 판별
    function isMobile() {
      return /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
        navigator.userAgent
      );
    }

    const gameContainer  = document.getElementById('gameContainer');
    const scoreElement   = document.getElementById('score');
    const startButton    = document.getElementById('startButton');
    const restartButton  = document.getElementById('restartButton');
    const gameOverMessage= document.getElementById('gameOverMessage');
    const happySong      = document.getElementById('happySong');
    const titleElement   = document.getElementById('title');

    // 풍선 개수 및 상태
    let balloonCount = 20;
    let score = 0;
    let gameStarted = false;
    let balloons = [];
    let animationId = null;

    // 풍선 색상 배열
    const balloonColors = [
      "#e91e63","#9c27b0","#2196f3","#4caf50","#ffeb3b","#ff9800",
      "#795548","#607d8b","#f44336","#ab47bc","#66bb6a","#ffa726"
    ];

    // PC/모바일 안내 문구
    if(isMobile()) {
      titleElement.textContent = "모바일 환경! 생일축하 풍선 터뜨리기 게임";
    }

    // ---------------------
    // 풍선 생성
    // ---------------------
    function createBalloons() {
      for (let i = 0; i < balloonCount; i++) {
        const balloon = document.createElement('div');
        balloon.classList.add('balloon');

        // 랜덤 색상
        const color = balloonColors[Math.floor(Math.random() * balloonColors.length)];
        balloon.style.background = color;

        // 랜덤 위치
        const x = Math.random() * (gameContainer.clientWidth  - 60);
        const y = Math.random() * (gameContainer.clientHeight - 80);
        balloon.style.left = x + 'px';
        balloon.style.top  = y + 'px';

        // 이동 속도
        const dx = (Math.random() * 6) - 3; 
        const dy = (Math.random() * 6) - 3;
        balloon.dataset.dx = dx;
        balloon.dataset.dy = dy;

        // 풍선 클릭(또는 터치)
        balloon.addEventListener('pointerdown', (e) => {
          // ★ 터치 확대 방지
          if(e && e.preventDefault) {
            e.preventDefault();
          }
          popBalloon(balloon);
        }, { passive: false }); // passive: false로 preventDefault 허용

        gameContainer.appendChild(balloon);
        balloons.push(balloon);
      }
    }

    // ---------------------
    // 풍선 터뜨리기
    // ---------------------
    function popBalloon(balloon) {
      balloon.remove();
      balloons = balloons.filter(b => b !== balloon);

      score++;
      scoreElement.textContent = score;
      if (score >= balloonCount) {
        endGame();
      }
    }

    // ---------------------
    // 풍선 움직임
    // ---------------------
    function moveBalloons() {
      balloons.forEach(balloon => {
        let x  = parseFloat(balloon.style.left);
        let y  = parseFloat(balloon.style.top);
        let dx = parseFloat(balloon.dataset.dx);
        let dy = parseFloat(balloon.dataset.dy);

        x += dx;
        y += dy;

        // 벽 충돌 반사
        if (x < 0) {
          x = 0; dx = -dx;
        } else if (x + 60 > gameContainer.clientWidth) {
          x = gameContainer.clientWidth - 60; dx = -dx;
        }
        if (y < 0) {
          y = 0; dy = -dy;
        } else if (y + 80 > gameContainer.clientHeight) {
          y = gameContainer.clientHeight - 80; dy = -dy;
        }

        balloon.style.left = x + 'px';
        balloon.style.top  = y + 'px';
        balloon.dataset.dx = dx;
        balloon.dataset.dy = dy;
      });

      animationId = requestAnimationFrame(moveBalloons);
    }

    // ---------------------
    // 폭죽(분수형) 효과
    // ---------------------
    function showFountain() {
      const fwContainer = document.createElement('div');
      fwContainer.id = 'fireworksContainer';
      document.body.appendChild(fwContainer);

      const sparkCount = 40;
      const sparkColors = [
        "#ff1744","#f50057","#d500f9","#651fff","#3d5afe","#2979ff","#00b0ff","#00e5ff",
        "#1de9b6","#00e676","#76ff03","#c6ff00","#ffea00","#ffc400","#ff9100","#ff3d00"
      ];
      const centerX = window.innerWidth / 2;
      const centerY = window.innerHeight * 0.8; // 아래쪽

      for (let i=0; i<sparkCount; i++) {
        const spark = document.createElement('div');
        spark.classList.add('spark');
        const c = sparkColors[Math.floor(Math.random() * sparkColors.length)];
        spark.style.background = c;

        spark.style.left = centerX + 'px';
        spark.style.top  = centerY + 'px';

        const angle = (Math.random() * 90) - 45;
        const distance = 200 + Math.random() * 200;
        const size = 8 + Math.random() * 8;

        spark.style.width = size + "px";
        spark.style.height= size + "px";

        const rad = angle * (Math.PI/180);
        const finalX = Math.cos(rad) * distance;
        const finalY = -Math.sin(rad)* distance;

        spark.style.setProperty('--spark-tx', finalX + 'px');
        spark.style.setProperty('--spark-ty', finalY + 'px');

        fwContainer.appendChild(spark);
      }

      setTimeout(() => {
        fwContainer.remove();
      }, 2500);
    }

    // ---------------------
    // 게임 시작
    // ---------------------
    function startGame() {
      if (gameStarted) return;

      gameStarted = true;
      startButton.style.display   = 'none';
      restartButton.style.display = 'none';
      gameOverMessage.style.display = 'none';

      score = 0;
      scoreElement.textContent = score;

      // 풍선 생성
      createBalloons();
      // 애니메이션 시작
      animationId = requestAnimationFrame(moveBalloons);

      // (옵션) 생일축하 노래 재생
      happySong.currentTime = 0;
      happySong.play().catch(err=>{
        console.log('오디오 재생 차단됨:', err);
      });
    }

    // ---------------------
    // 게임 종료
    // ---------------------
    function endGame() {
      cancelAnimationFrame(animationId);
      showFountain(); // 폭죽

      gameOverMessage.style.display = 'block';
      restartButton.style.display   = 'inline-block';

      // 노래 중지하고 싶다면:
      // happySong.pause();
    }

    // ---------------------
    // 게임 다시 시작
    // ---------------------
    function restartGame() {
      // 기존 풍선 제거
      balloons.forEach(b => b.remove());
      balloons = [];
      cancelAnimationFrame(animationId);
      gameStarted = false;

      // 재시작
      startGame();
    }

    // ---------------------
    // 이벤트 설정
    // ---------------------
    startButton.addEventListener('click', startGame);
    restartButton.addEventListener('click', restartGame);
  </script>
</body>
</html>
